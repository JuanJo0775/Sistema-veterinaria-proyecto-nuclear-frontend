{% extends "client/client_base.html" %}

{% block title %}Agendar Cita{% endblock %}

{% block custom_styles %}
<style>
    /* =============== BOOK APPOINTMENT SPECIFIC STYLES - CORREGIDOS =============== */
    .booking-content {
        padding: 30px;
    }

    .page-header {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 25px rgba(8, 28, 21, 0.1);
        margin-bottom: 30px;
        text-align: center;
        border: 2px solid #D8F3DC;
    }

    .header-title {
        color: #2D6A4F;
        font-size: 2.4rem;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        font-weight: 700;
    }

    .header-subtitle {
        color: #52B788;
        font-size: 1.2rem;
        margin: 0;
        font-weight: 500;
    }

    /* PROGRESS BAR - MEJORADO */
    .progress-container {
        background: linear-gradient(135deg, #D8F3DC 0%, #B7E4C7 100%);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 25px rgba(8, 28, 21, 0.1);
        margin-bottom: 30px;
        border: 2px solid #B7E4C7;
    }

    .progress-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        margin-bottom: 25px;
    }

    .progress-step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 2;
        transition: all 0.4s ease;
    }

    .step-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: white;
        border: 4px solid #B7E4C7;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
        font-weight: bold;
        color: #52B788;
        transition: all 0.4s ease;
        box-shadow: 0 4px 15px rgba(8, 28, 21, 0.1);
    }

    .step-circle.active {
        background: linear-gradient(135deg, #52B788, #38A3A5);
        border-color: #2D6A4F;
        color: white;
        transform: scale(1.2);
        box-shadow: 0 8px 25px rgba(82, 183, 136, 0.4);
    }

    .step-circle.completed {
        background: linear-gradient(135deg, #2D6A4F, #22577A);
        border-color: #081C15;
        color: white;
        box-shadow: 0 6px 20px rgba(45, 106, 79, 0.3);
    }

    .step-label {
        margin-top: 12px;
        font-size: 0.9rem;
        color: #2D6A4F;
        font-weight: 600;
        text-align: center;
        transition: all 0.3s ease;
    }

    .step-circle.active + .step-label {
        color: #2D6A4F;
        font-weight: 700;
        transform: scale(1.05);
    }

    .progress-line {
        position: absolute;
        top: 30px;
        left: 0;
        width: 100%;
        height: 4px;
        background: #B7E4C7;
        z-index: 1;
        border-radius: 2px;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(135deg, #52B788, #38A3A5);
        transition: width 0.6s ease;
        border-radius: 2px;
        box-shadow: 0 2px 8px rgba(82, 183, 136, 0.3);
    }

    /* STEP CONTENT - MEJORADO */
    .step-content {
        background: white;
        border-radius: 20px;
        box-shadow: 0 8px 25px rgba(8, 28, 21, 0.1);
        overflow: hidden;
        min-height: 550px;
        display: none;
        border: 2px solid #D8F3DC;
    }

    .step-content.active {
        display: block;
        animation: slideInFade 0.6s ease-out;
    }

    @keyframes slideInFade {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .step-header {
        padding: 30px 30px 0;
        text-align: center;
        background: linear-gradient(135deg, #D8F3DC 0%, #B7E4C7 100%);
    }

    .step-title {
        font-size: 2rem;
        color: #2D6A4F;
        margin-bottom: 10px;
        font-weight: 700;
    }

    .step-description {
        color: #52B788;
        margin-bottom: 30px;
        font-size: 1.1rem;
        font-weight: 500;
    }

    .step-body {
        padding: 30px;
    }

    /* STEP 1: MASCOTAS - MEJORADO */
    .pets-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
    }

    .pet-card {
        background: linear-gradient(135deg, #D8F3DC 0%, white 100%);
        border-radius: 20px;
        padding: 30px;
        cursor: pointer;
        transition: all 0.4s ease;
        border: 3px solid transparent;
        position: relative;
        overflow: hidden;
    }

    .pet-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(82, 183, 136, 0.1), rgba(56, 163, 165, 0.1));
        opacity: 0;
        transition: opacity 0.4s ease;
        z-index: 1;
    }

    .pet-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(8, 28, 21, 0.15);
        border-color: #B7E4C7;
    }

    .pet-card:hover::before {
        opacity: 1;
    }

    .pet-card.selected {
        border-color: #52B788;
        background: linear-gradient(135deg, rgba(82, 183, 136, 0.15), rgba(56, 163, 165, 0.1));
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(82, 183, 136, 0.25);
    }

    .pet-card.selected::before {
        opacity: 1;
        background: linear-gradient(135deg, rgba(82, 183, 136, 0.2), rgba(56, 163, 165, 0.15));
    }

    .pet-info {
        display: flex;
        align-items: center;
        gap: 20px;
        position: relative;
        z-index: 2;
    }

    .pet-avatar {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        background: linear-gradient(135deg, #52B788, #38A3A5);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
        border: 4px solid #B7E4C7;
        box-shadow: 0 4px 15px rgba(82, 183, 136, 0.3);
        flex-shrink: 0;
    }

    .pet-details h3 {
        color: #2D6A4F;
        font-size: 1.4rem;
        margin-bottom: 8px;
        font-weight: 700;
    }

    .pet-details p {
        color: #52B788;
        font-size: 1rem;
        margin: 4px 0;
        font-weight: 500;
    }

    /* STEP 2: VETERINARIOS - MEJORADO */
    .vets-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
    }

    .vet-card {
        background: linear-gradient(135deg, #D8F3DC 0%, white 100%);
        border-radius: 20px;
        padding: 30px;
        cursor: pointer;
        transition: all 0.4s ease;
        border: 3px solid transparent;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .vet-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(56, 163, 165, 0.1), rgba(34, 87, 122, 0.1));
        opacity: 0;
        transition: opacity 0.4s ease;
        z-index: 1;
    }

    .vet-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(8, 28, 21, 0.15);
        border-color: #B7E4C7;
    }

    .vet-card:hover::before {
        opacity: 1;
    }

    .vet-card.selected {
        border-color: #38A3A5;
        background: linear-gradient(135deg, rgba(56, 163, 165, 0.15), rgba(34, 87, 122, 0.1));
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(56, 163, 165, 0.25);
    }

    .vet-card.selected::before {
        opacity: 1;
        background: linear-gradient(135deg, rgba(56, 163, 165, 0.2), rgba(34, 87, 122, 0.15));
    }

    .vet-avatar {
        width: 90px;
        height: 90px;
        border-radius: 50%;
        background: linear-gradient(135deg, #38A3A5, #22577A);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.2rem;
        color: white;
        margin: 0 auto 20px;
        border: 4px solid #B7E4C7;
        box-shadow: 0 6px 20px rgba(56, 163, 165, 0.3);
        position: relative;
        z-index: 2;
    }

    .vet-name {
        font-size: 1.5rem;
        color: #2D6A4F;
        margin-bottom: 10px;
        font-weight: 700;
        position: relative;
        z-index: 2;
    }

    .vet-specialty {
        color: #52B788;
        margin-bottom: 20px;
        font-size: 1.1rem;
        font-weight: 600;
        position: relative;
        z-index: 2;
    }

    .vet-schedule {
        background: rgba(183, 228, 199, 0.4);
        border-radius: 12px;
        padding: 15px;
        font-size: 0.9rem;
        color: #2D6A4F;
        border: 2px solid #B7E4C7;
        font-weight: 500;
        position: relative;
        z-index: 2;
    }

    /* STEP 3: CALENDARIO - MEJORADO */
    .calendar-container {
        background: linear-gradient(135deg, #D8F3DC 0%, #B7E4C7 100%);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        border: 2px solid #B7E4C7;
        box-shadow: 0 8px 25px rgba(8, 28, 21, 0.1);
    }

    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }

    .calendar-nav {
        background: linear-gradient(135deg, #52B788, #38A3A5);
        color: white;
        border: none;
        padding: 15px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.4s ease;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
        font-weight: bold;
        box-shadow: 0 4px 15px rgba(82, 183, 136, 0.3);
    }

    .calendar-nav:hover {
        background: linear-gradient(135deg, #2D6A4F, #22577A);
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(82, 183, 136, 0.4);
    }

    .calendar-month {
        font-size: 1.8rem;
        font-weight: 700;
        color: #2D6A4F;
        text-transform: capitalize;
        text-shadow: 0 2px 4px rgba(8, 28, 21, 0.1);
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 3px;
        background: #B7E4C7;
        border-radius: 15px;
        padding: 3px;
    }

    .calendar-day-header {
        text-align: center;
        padding: 15px 8px;
        font-weight: 700;
        color: white;
        background: linear-gradient(135deg, #52B788, #38A3A5);
        font-size: 0.95rem;
        border-radius: 8px;
    }

    .calendar-day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.4s ease;
        position: relative;
        font-weight: 600;
        color: #2D6A4F;
        font-size: 1.1rem;
        background: white;
    }

    .calendar-day.available {
        border: 2px solid transparent;
    }

    .calendar-day.available:hover {
        background: linear-gradient(135deg, #B7E4C7, #D8F3DC);
        border-color: #52B788;
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(82, 183, 136, 0.2);
    }

    .calendar-day.selected {
        background: linear-gradient(135deg, #52B788, #38A3A5);
        color: white;
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(82, 183, 136, 0.4);
        border: 2px solid #2D6A4F;
    }

    .calendar-day.disabled {
        color: #ccc;
        cursor: not-allowed;
        background: #f5f5f5;
        opacity: 0.5;
    }

    .calendar-day.today {
        background: linear-gradient(135deg, #22577A, #38A3A5);
        color: white;
        font-weight: 700;
    }

    /* STEP 4: HORARIOS - MEJORADO */
    .time-slots {
        margin-bottom: 30px;
    }

    .time-period {
        margin-bottom: 30px;
    }

    .time-period-title {
        font-size: 1.4rem;
        color: #2D6A4F;
        margin-bottom: 20px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 15px 0;
        border-bottom: 3px solid #D8F3DC;
    }

    .time-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 15px;
    }

    .time-slot {
        background: white;
        border: 3px solid #D8F3DC;
        border-radius: 15px;
        padding: 18px;
        text-align: center;
        cursor: pointer;
        transition: all 0.4s ease;
        font-weight: 600;
        color: #2D6A4F;
        font-size: 1.1rem;
        position: relative;
        overflow: hidden;
    }

    .time-slot::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(82, 183, 136, 0.1), rgba(56, 163, 165, 0.1));
        opacity: 0;
        transition: opacity 0.4s ease;
    }

    .time-slot:hover {
        border-color: #52B788;
        background: #B7E4C7;
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(82, 183, 136, 0.2);
    }

    .time-slot:hover::before {
        opacity: 1;
    }

    .time-slot.selected {
        background: linear-gradient(135deg, #52B788, #38A3A5);
        border-color: #2D6A4F;
        color: white;
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(82, 183, 136, 0.3);
    }

    .time-slot.occupied {
        background: #f8f9fa;
        border-color: #dee2e6;
        color: #6c757d;
        cursor: not-allowed;
        opacity: 0.6;
    }

    /* STEP 5: DETALLES - MEJORADO */
    .form-group {
        margin-bottom: 25px;
    }

    .form-label {
        display: block;
        margin-bottom: 10px;
        font-weight: 700;
        color: #2D6A4F;
        font-size: 1.1rem;
    }

    .form-select,
    .form-textarea {
        width: 100%;
        padding: 18px 20px;
        border: 3px solid #D8F3DC;
        border-radius: 15px;
        font-size: 1rem;
        transition: all 0.4s ease;
        background: white;
        color: #2D6A4F;
        font-weight: 500;
    }

    .form-select:focus,
    .form-textarea:focus {
        outline: none;
        border-color: #52B788;
        box-shadow: 0 0 0 4px rgba(82, 183, 136, 0.15);
        background: linear-gradient(135deg, white 0%, rgba(216, 243, 220, 0.3) 100%);
    }

    .form-textarea {
        resize: vertical;
        min-height: 130px;
        font-family: inherit;
        line-height: 1.6;
    }

    .booking-summary {
        background: linear-gradient(135deg, #D8F3DC 0%, #B7E4C7 100%);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        border: 3px solid #B7E4C7;
        box-shadow: 0 8px 25px rgba(8, 28, 21, 0.1);
    }

    .summary-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: #2D6A4F;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 2px solid rgba(183, 228, 199, 0.5);
    }

    .summary-item:last-child {
        border-bottom: none;
    }

    .summary-label {
        font-weight: 700;
        color: #52B788;
        font-size: 1rem;
    }

    .summary-value {
        color: #2D6A4F;
        font-weight: 600;
        font-size: 1rem;
    }

    /* NAVEGACI√ìN - MEJORADA */
    .step-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 30px;
        border-top: 2px solid #D8F3DC;
        background: linear-gradient(135deg, #D8F3DC 0%, #B7E4C7 100%);
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
    }

    .btn {
        padding: 15px 30px;
        border: none;
        border-radius: 25px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.4s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        box-shadow: 0 4px 15px rgba(8, 28, 21, 0.1);
    }

    .btn-primary {
        background: linear-gradient(135deg, #52B788, #38A3A5);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(82, 183, 136, 0.3);
        background: linear-gradient(135deg, #38A3A5, #22577A);
    }

    .btn-secondary {
        background: white;
        color: #52B788;
        border: 3px solid #D8F3DC;
    }

    .btn-secondary:hover {
        background: #D8F3DC;
        border-color: #B7E4C7;
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(183, 228, 199, 0.3);
    }

    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
    }

    /* LOADING - MEJORADO */
    .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px;
        color: #52B788;
    }

    .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #D8F3DC;
        border-top: 5px solid #52B788;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
        box-shadow: 0 4px 15px rgba(82, 183, 136, 0.2);
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* ERROR & SUCCESS STATES - MEJORADOS */
    .empty-state {
        text-align: center;
        padding: 60px;
        color: #52B788;
        background: linear-gradient(135deg, #D8F3DC 0%, #B7E4C7 100%);
        border-radius: 20px;
        border: 2px solid #B7E4C7;
    }

    .empty-state h3 {
        color: #2D6A4F;
        margin: 20px 0 15px;
        font-size: 1.6rem;
        font-weight: 700;
    }

    .empty-state p {
        margin-bottom: 25px;
        font-size: 1.1rem;
        font-weight: 500;
    }

    /* RESPONSIVE - MEJORADO */
    @media (max-width: 768px) {
        .booking-content {
            padding: 15px;
        }

        .page-header,
        .progress-container,
        .step-content {
            margin-bottom: 20px;
        }

        .header-title {
            font-size: 2rem;
        }

        .pets-grid,
        .vets-grid {
            grid-template-columns: 1fr;
        }

        .step-navigation {
            flex-direction: column;
            gap: 15px;
        }

        .calendar-grid {
            gap: 2px;
        }

        .time-grid {
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }

        .step-circle {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
        }

        .calendar-nav {
            width: 45px;
            height: 45px;
            font-size: 1.2rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="booking-content">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="header-title">
            üóìÔ∏è Agendar Nueva Cita
        </h1>
        <p class="header-subtitle">Programa la atenci√≥n m√©dica para tu mascota en 5 simples pasos</p>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-line">
                <div class="progress-fill" id="progressFill" style="width: 20%;"></div>
            </div>
            <div class="progress-step">
                <div class="step-circle active" id="step1Circle">1</div>
                <div class="step-label">Mi Mascota</div>
            </div>
            <div class="progress-step">
                <div class="step-circle" id="step2Circle">2</div>
                <div class="step-label">Veterinario</div>
            </div>
            <div class="progress-step">
                <div class="step-circle" id="step3Circle">3</div>
                <div class="step-label">Fecha</div>
            </div>
            <div class="progress-step">
                <div class="step-circle" id="step4Circle">4</div>
                <div class="step-label">Horario</div>
            </div>
            <div class="progress-step">
                <div class="step-circle" id="step5Circle">5</div>
                <div class="step-label">Confirmar</div>
            </div>
        </div>
    </div>

    <!-- Step 1: Seleccionar Mascota -->
    <div class="step-content active" id="step1">
        <div class="step-header">
            <h2 class="step-title">üêæ Selecciona tu mascota</h2>
            <p class="step-description">Elige cu√°l de tus compa√±eros necesita atenci√≥n m√©dica</p>
        </div>
        <div class="step-body">
            <div class="pets-grid" id="petsGrid">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Cargando tus mascotas...</span>
                </div>
            </div>
        </div>
        <div class="step-navigation">
            <a href="{{ url_for('frontend.client_dashboard') }}" class="btn btn-secondary">
                ‚Üê Cancelar
            </a>
            <button class="btn btn-primary" id="nextStep1" disabled>
                Continuar ‚Üí
            </button>
        </div>
    </div>

    <!-- Step 2: Seleccionar Veterinario -->
    <div class="step-content" id="step2">
        <div class="step-header">
            <h2 class="step-title">üë®‚Äç‚öïÔ∏è Elige tu veterinario</h2>
            <p class="step-description">Selecciona el profesional que atender√° a tu mascota</p>
        </div>
        <div class="step-body">
            <div class="vets-grid" id="vetsGrid">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Cargando veterinarios disponibles...</span>
                </div>
            </div>
        </div>
        <div class="step-navigation">
            <button class="btn btn-secondary" id="prevStep2">
                ‚Üê Anterior
            </button>
            <button class="btn btn-primary" id="nextStep2" disabled>
                Continuar ‚Üí
            </button>
        </div>
    </div>

    <!-- Step 3: Seleccionar Fecha -->
    <div class="step-content" id="step3">
        <div class="step-header">
            <h2 class="step-title">üìÖ Selecciona la fecha</h2>
            <p class="step-description">Elige un d√≠a disponible seg√∫n el horario del veterinario</p>
        </div>
        <div class="step-body">
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="calendar-nav" id="prevMonth">‚Äπ</button>
                    <div class="calendar-month" id="currentMonth"></div>
                    <button class="calendar-nav" id="nextMonth">‚Ä∫</button>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar will be generated here -->
                </div>
            </div>
        </div>
        <div class="step-navigation">
            <button class="btn btn-secondary" id="prevStep3">
                ‚Üê Anterior
            </button>
            <button class="btn btn-primary" id="nextStep3" disabled>
                Continuar ‚Üí
            </button>
        </div>
    </div>

    <!-- Step 4: Seleccionar Horario -->
    <div class="step-content" id="step4">
        <div class="step-header">
            <h2 class="step-title">‚è∞ Elige el horario</h2>
            <p class="step-description">Selecciona la hora que mejor se adapte a tu disponibilidad</p>
        </div>
        <div class="step-body">
            <div class="time-slots" id="timeSlots">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Cargando horarios disponibles...</span>
                </div>
            </div>
        </div>
        <div class="step-navigation">
            <button class="btn btn-secondary" id="prevStep4">
                ‚Üê Anterior
            </button>
            <button class="btn btn-primary" id="nextStep4" disabled>
                Continuar ‚Üí
            </button>
        </div>
    </div>

    <!-- Step 5: Confirmar Detalles -->
    <div class="step-content" id="step5">
        <div class="step-header">
            <h2 class="step-title">‚úÖ Confirma los detalles</h2>
            <p class="step-description">Revisa la informaci√≥n y completa los datos de tu cita</p>
        </div>
        <div class="step-body">
            <div class="booking-summary" id="bookingSummary">
                <!-- Summary will be generated here -->
            </div>

            <form id="appointmentForm">
                <div class="form-group">
                    <label class="form-label" for="consultationType">Tipo de consulta *</label>
                    <select class="form-select" id="consultationType" required>
                        <option value="">Seleccionar tipo de consulta</option>
                        <option value="general">Consulta General</option>
                        <option value="control">Control de Salud</option>
                        <option value="vaccination">Vacunaci√≥n</option>
                        <option value="emergency">Emergencia</option>
                        <option value="surgery">Cirug√≠a</option>
                        <option value="checkup">Chequeo</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="consultationReason">Motivo de la consulta *</label>
                    <textarea class="form-textarea" id="consultationReason" 
                            placeholder="Describe brevemente el motivo de la consulta, s√≠ntomas observados o cualquier informaci√≥n relevante que pueda ayudar al veterinario..." 
                            required></textarea>
                </div>
            </form>
        </div>
        <div class="step-navigation">
            <button class="btn btn-secondary" id="prevStep5">
                ‚Üê Anterior
            </button>
            <button class="btn btn-primary" id="confirmBooking" disabled>
                üóìÔ∏è Confirmar Cita
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
(function() {
    'use strict';

    // =============== CONFIGURACI√ìN Y VARIABLES ===============
    const USER_ID = '{{ user.id if user and user.id else "" }}';
    const USER_TOKEN = '{{ session.get("token") if session.get("token") else "" }}';
    const ADD_PET_URL = '{{ url_for("frontend.client_add_pet") }}';
    const DASHBOARD_URL = '{{ url_for("frontend.client_dashboard") }}';

    // Validar sesi√≥n
    if (!USER_ID || !USER_TOKEN) {
        console.error('‚ùå Datos de usuario no disponibles');
        showMessage('Error: Sesi√≥n no v√°lida. Por favor inicia sesi√≥n nuevamente.', 'error');
        setTimeout(() => window.location.href = '/login', 2000);
        return;
    }

    // Variables del estado de la aplicaci√≥n
    let currentStep = 1;
    let selectedPet = null;
    let selectedVet = null;
    let selectedDate = null;
    let selectedTime = null;
    let currentMonth = new Date();
    let userPets = [];
    let veterinarians = [];

    // =============== INICIALIZACI√ìN ===============
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Inicializando sistema de agendamiento...');
        console.log('üë§ Usuario:', USER_ID);
        initializeBooking();
    });

    async function initializeBooking() {
        setupEventListeners();
        await loadUserPets();
    }

    // =============== EVENT LISTENERS ===============
    function setupEventListeners() {
        // Navegaci√≥n entre pasos
        document.getElementById('nextStep1').addEventListener('click', () => goToStep(2));
        document.getElementById('nextStep2').addEventListener('click', () => goToStep(3));
        document.getElementById('nextStep3').addEventListener('click', () => goToStep(4));
        document.getElementById('nextStep4').addEventListener('click', () => goToStep(5));

        document.getElementById('prevStep2').addEventListener('click', () => goToStep(1));
        document.getElementById('prevStep3').addEventListener('click', () => goToStep(2));
        document.getElementById('prevStep4').addEventListener('click', () => goToStep(3));
        document.getElementById('prevStep5').addEventListener('click', () => goToStep(4));

        // Navegaci√≥n del calendario
        document.getElementById('prevMonth').addEventListener('click', () => {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            renderCalendar();
        });

        // Validaci√≥n del formulario final
        document.getElementById('consultationType').addEventListener('change', validateFinalForm);
        document.getElementById('consultationReason').addEventListener('input', validateFinalForm);

        // Confirmaci√≥n de cita
        document.getElementById('confirmBooking').addEventListener('click', confirmAppointment);
    }

    // =============== CARGA DE DATOS ===============
    async function loadUserPets() {
        try {
            console.log('üêæ Cargando mascotas del usuario...');
            
            const response = await fetch('/api/client/pets', {
                headers: {
                    'Authorization': `Bearer ${USER_TOKEN}`,
                    'Content-Type': 'application/json'
                }
            });

            console.log(`üì° Respuesta mascotas: ${response.status}`);

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            console.log('üì¶ Datos de mascotas:', data);

            if (data.success) {
                userPets = data.pets || [];
                console.log(`‚úÖ ${userPets.length} mascotas cargadas`);
                renderPets();
            } else {
                throw new Error(data.message || 'Error al cargar mascotas');
            }

        } catch (error) {
            console.error('‚ùå Error cargando mascotas:', error);
            showEmptyState('petsGrid', 'üêæ', 'No tienes mascotas registradas', 
                'Primero debes registrar una mascota para poder agendar citas', 
                'Registrar Mi Primera Mascota', ADD_PET_URL);
        }
    }

    async function loadVeterinarians() {
        try {
            console.log('üë®‚Äç‚öïÔ∏è Cargando veterinarios...');
            
            const response = await fetch('/api/client/veterinarians', {
                headers: {
                    'Authorization': `Bearer ${USER_TOKEN}`,
                    'Content-Type': 'application/json'
                }
            });

            console.log(`üì° Respuesta veterinarios: ${response.status}`);

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            console.log('üì¶ Datos de veterinarios:', data);

            if (data.success) {
                veterinarians = data.veterinarians || [];
                console.log(`‚úÖ ${veterinarians.length} veterinarios cargados`);

                if (veterinarians.length === 0) {
                    showEmptyState('vetsGrid', 'üë®‚Äç‚öïÔ∏è', 'No hay veterinarios disponibles', 
                        'No se encontraron veterinarios disponibles en este momento.', null, null);
                    return;
                }

                renderVeterinarians();
            } else {
                throw new Error(data.message || 'Error al cargar veterinarios');
            }

        } catch (error) {
            console.error('‚ùå Error cargando veterinarios:', error);
            showEmptyState('vetsGrid', 'üë®‚Äç‚öïÔ∏è', 'Error al cargar veterinarios', 
                'No se pudieron cargar los veterinarios disponibles. Verifica tu conexi√≥n.', null, null);
        }
    }

    async function loadAvailability() {
        if (!selectedVet || !selectedDate) return;

        try {
            const container = document.getElementById('timeSlots');
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Cargando horarios disponibles...</span>
                </div>
            `;

            console.log(`‚è∞ Cargando disponibilidad para ${selectedVet} en ${selectedDate}`);

            const response = await fetch(`/api/client/availability/${selectedVet}/${selectedDate}`, {
                headers: {
                    'Authorization': `Bearer ${USER_TOKEN}`,
                    'Content-Type': 'application/json'
                }
            });

            console.log(`üì° Respuesta disponibilidad: ${response.status}`);

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }

            const data = await response.json();
            console.log('üì¶ Datos de disponibilidad:', data);

            if (data.success && data.available_slots && data.available_slots.length > 0) {
                renderTimeSlots(data.available_slots);
            } else {
                showEmptyState('timeSlots', '‚è∞', 'Sin horarios disponibles',
                    data.message || 'No hay horarios disponibles para esta fecha seg√∫n la agenda del veterinario.',
                    null, null);
            }

        } catch (error) {
            console.error('‚ùå Error cargando disponibilidad:', error);
            showEmptyState('timeSlots', '‚ùå', 'Error de conexi√≥n',
                'No se pudo cargar la disponibilidad. Por favor, contacta a la cl√≠nica.',
                null, null);
        }
    }

    // =============== FUNCIONES DE RENDERIZADO ===============
    function renderPets() {
        const grid = document.getElementById('petsGrid');

        if (userPets.length === 0) {
            showEmptyState('petsGrid', 'üêæ', 'No tienes mascotas registradas', 
                'Primero debes registrar una mascota para poder agendar citas', 
                'Registrar Mi Primera Mascota', ADD_PET_URL);
            return;
        }

        grid.innerHTML = userPets.map(pet => `
            <div class="pet-card" onclick="selectPet('${pet.id}')" data-pet-id="${pet.id}">
                <div class="pet-info">
                    <div class="pet-avatar">${getPetIcon(pet.species)}</div>
                    <div class="pet-details">
                        <h3>${pet.name}</h3>
                        <p>${capitalizePetSpecies(pet.species)} ‚Ä¢ ${pet.breed || 'Raza mixta'}</p>
                        <p>${formatPetAge(pet.age_years, pet.age_months)}${pet.weight ? ` ‚Ä¢ ${pet.weight}kg` : ''}</p>
                        ${pet.vaccination_status ? `<p>Vacunaci√≥n: ${getVaccinationStatus(pet.vaccination_status)}</p>` : ''}
                    </div>
                </div>
            </div>
        `).join('');

        console.log('üé® Mascotas renderizadas');
    }

    function renderVeterinarians() {
        const grid = document.getElementById('vetsGrid');

        if (veterinarians.length === 0) {
            showEmptyState('vetsGrid', 'üë®‚Äç‚öïÔ∏è', 'No hay veterinarios disponibles', 
                'No se encontraron veterinarios disponibles en este momento.', null, null);
            return;
        }

        grid.innerHTML = veterinarians.map(vet => `
            <div class="vet-card" onclick="selectVet('${vet.id}')" data-vet-id="${vet.id}">
                <div class="vet-avatar">üë®‚Äç‚öïÔ∏è</div>
                <div class="vet-name">Dr. ${vet.first_name} ${vet.last_name}</div>
                <div class="vet-specialty">${vet.specialty || 'Medicina General'}</div>
                <div class="vet-schedule">
                    ${getScheduleText(vet.schedule)}
                </div>
            </div>
        `).join('');

        console.log('üé® Veterinarios renderizados');
    }

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        const monthYear = document.getElementById('currentMonth');

        const monthNames = [
            'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
            'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
        ];

        monthYear.textContent = `${monthNames[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;

        // Headers de d√≠as
        const dayHeaders = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
        let calendarHTML = dayHeaders.map(day =>
            `<div class="calendar-day-header">${day}</div>`
        ).join('');

        // D√≠as del mes
        const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
        const lastDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0);
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        // D√≠as vac√≠os al inicio
        for (let i = 0; i < firstDay.getDay(); i++) {
            calendarHTML += '<div class="calendar-day"></div>';
        }

        // D√≠as del mes
        for (let day = 1; day <= lastDay.getDate(); day++) {
            const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day);
            const dateString = date.toISOString().split('T')[0];
            const isAvailable = isDateAvailable(date);
            const isPast = date < today;
            const isToday = date.toDateString() === today.toDateString();

            let classes = 'calendar-day';
            if (isPast) {
                classes += ' disabled';
            } else if (isAvailable) {
                classes += ' available';
            } else {
                classes += ' disabled';
            }

            if (isToday) {
                classes += ' today';
            }

            if (selectedDate === dateString) {
                classes += ' selected';
            }

            const clickHandler = (!isPast && isAvailable) ? `selectDate('${dateString}')` : '';

            calendarHTML += `
                <div class="${classes}" onclick="${clickHandler}" data-date="${dateString}">
                    ${day}
                </div>
            `;
        }

        grid.innerHTML = calendarHTML;
    }

    function renderTimeSlots(availableSlots = []) {
        const container = document.getElementById('timeSlots');

        if (!selectedVet || !selectedDate) {
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Selecciona veterinario y fecha primero</span>
                </div>
            `;
            return;
        }

        if (availableSlots.length === 0) {
            showEmptyState('timeSlots', '‚è∞', 'Sin horarios disponibles', 
                'No hay horarios disponibles para esta fecha seg√∫n la agenda del veterinario.', null, null);
            return;
        }

        // Separar slots por jornada
        const morningSlots = availableSlots.filter(slot => {
            const slotMinutes = timeToMinutes(slot);
            return slotMinutes < 720; // 12:00 = 720 minutos
        });

        const afternoonSlots = availableSlots.filter(slot => {
            const slotMinutes = timeToMinutes(slot);
            return slotMinutes >= 720; // 12:00 = 720 minutos
        });

        let slotsHTML = '';

        // Jornada de ma√±ana
        if (morningSlots.length > 0) {
            slotsHTML += `
                <div class="time-period">
                    <div class="time-period-title">üåÖ Jornada de Ma√±ana</div>
                    <div class="time-grid">
                        ${morningSlots.map(slot => `
                            <div class="time-slot" onclick="selectTime('${slot}')" data-time="${slot}">
                                ${slot}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Jornada de tarde
        if (afternoonSlots.length > 0) {
            slotsHTML += `
                <div class="time-period">
                    <div class="time-period-title">üåÜ Jornada de Tarde</div>
                    <div class="time-grid">
                        ${afternoonSlots.map(slot => `
                            <div class="time-slot" onclick="selectTime('${slot}')" data-time="${slot}">
                                ${slot}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        container.innerHTML = slotsHTML;
        console.log(`üé® Horarios renderizados: ${availableSlots.length} slots`);
    }

    function renderBookingSummary() {
        const container = document.getElementById('bookingSummary');
        const pet = userPets.find(p => p.id === selectedPet);
        const vet = veterinarians.find(v => v.id === selectedVet);

        container.innerHTML = `
            <div class="summary-title">üìã Resumen de la Cita</div>
            <div class="summary-item">
                <span class="summary-label">üêæ Mascota:</span>
                <span class="summary-value">${pet.name} (${capitalizePetSpecies(pet.species)})</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">üë®‚Äç‚öïÔ∏è Veterinario:</span>
                <span class="summary-value">Dr. ${vet.first_name} ${vet.last_name}</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">üìÖ Fecha:</span>
                <span class="summary-value">${formatDate(selectedDate)}</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">üïê Hora:</span>
                <span class="summary-value">${selectedTime}</span>
            </div>
        `;
    }

    // =============== FUNCIONES DE SELECCI√ìN ===============
    function selectPet(petId) {
        console.log('üêæ Seleccionando mascota:', petId);

        // Remover selecci√≥n anterior
        document.querySelectorAll('.pet-card').forEach(card => card.classList.remove('selected'));

        // Seleccionar nueva mascota
        const petCard = document.querySelector(`[data-pet-id="${petId}"]`);
        if (petCard) {
            petCard.classList.add('selected');
            selectedPet = petId;
            document.getElementById('nextStep1').disabled = false;
            console.log('‚úÖ Mascota seleccionada:', petId);
        }
    }

    function selectVet(vetId) {
        console.log('üë®‚Äç‚öïÔ∏è Seleccionando veterinario:', vetId);

        document.querySelectorAll('.vet-card').forEach(card => card.classList.remove('selected'));
        const vetCard = document.querySelector(`[data-vet-id="${vetId}"]`);
        
        if (vetCard) {
            vetCard.classList.add('selected');
            selectedVet = vetId;

            // Resetear fecha y hora seleccionadas
            selectedDate = null;
            selectedTime = null;

            document.getElementById('nextStep2').disabled = false;
            console.log('‚úÖ Veterinario seleccionado:', vetId);
        }
    }

    function selectDate(dateString) {
        console.log('üìÖ Seleccionando fecha:', dateString);

        const dateElement = document.querySelector(`[data-date="${dateString}"]`);

        if (dateElement && !dateElement.classList.contains('disabled')) {
            document.querySelectorAll('.calendar-day').forEach(day => day.classList.remove('selected'));
            dateElement.classList.add('selected');
            selectedDate = dateString;

            // Resetear hora seleccionada
            selectedTime = null;

            document.getElementById('nextStep3').disabled = false;
            console.log('‚úÖ Fecha seleccionada:', dateString);

            // Cargar horarios disponibles
            loadAvailability();
        }
    }

    function selectTime(time) {
        console.log('üïê Seleccionando hora:', time);

        document.querySelectorAll('.time-slot').forEach(slot => slot.classList.remove('selected'));
        const timeSlot = document.querySelector(`[data-time="${time}"]`);
        
        if (timeSlot) {
            timeSlot.classList.add('selected');
            selectedTime = time;
            document.getElementById('nextStep4').disabled = false;
            console.log('‚úÖ Hora seleccionada:', time);
        }
    }

    // =============== NAVEGACI√ìN ENTRE PASOS ===============
    function goToStep(step) {
        console.log(`üîÑ Navegando al paso ${step}`);

        // Ocultar paso actual
        document.querySelectorAll('.step-content').forEach(content => content.classList.remove('active'));
        document.querySelectorAll('.step-circle').forEach(circle => circle.classList.remove('active'));

        // Mostrar nuevo paso
        document.getElementById(`step${step}`).classList.add('active');
        document.getElementById(`step${step}Circle`).classList.add('active');

        // Actualizar c√≠rculos completados
        for (let i = 1; i < step; i++) {
            document.getElementById(`step${i}Circle`).classList.add('completed');
        }

        // Actualizar barra de progreso
        const progressFill = document.getElementById('progressFill');
        progressFill.style.width = `${(step * 20)}%`;

        currentStep = step;

        // Cargar datos espec√≠ficos del paso
        switch(step) {
            case 2:
                loadVeterinarians();
                break;
            case 3:
                renderCalendar();
                break;
            case 4:
                // Los horarios se cargan cuando se selecciona una fecha
                break;
            case 5:
                renderBookingSummary();
                break;
        }
    }

    function validateFinalForm() {
        const type = document.getElementById('consultationType').value;
        const reason = document.getElementById('consultationReason').value.trim();

        document.getElementById('confirmBooking').disabled = !type || !reason || reason.length < 10;
    }

    // =============== CONFIRMACI√ìN DE CITA ===============
    async function confirmAppointment() {
        try {
            const type = document.getElementById('consultationType').value;
            const reason = document.getElementById('consultationReason').value.trim();

            if (!type || !reason) {
                showMessage('Por favor completa todos los campos requeridos', 'error');
                return;
            }

            if (reason.length < 10) {
                showMessage('El motivo debe tener al menos 10 caracteres', 'error');
                return;
            }

            const appointmentData = {
                pet_id: selectedPet,
                veterinarian_id: selectedVet,
                appointment_date: selectedDate,
                appointment_time: selectedTime,
                consultation_type: type,
                reason: reason
            };

            console.log('üìù Enviando datos de la cita:', appointmentData);

            // Deshabilitar bot√≥n
            const confirmBtn = document.getElementById('confirmBooking');
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = '<div class="spinner" style="width: 20px; height: 20px; margin-right: 10px;"></div>Agendando...';

            const response = await fetch('/api/client/appointments', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${USER_TOKEN}`
                },
                body: JSON.stringify(appointmentData)
            });

            console.log(`üì° Respuesta del servidor: ${response.status}`);

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || `HTTP ${response.status}`);
            }

            const data = await response.json();
            console.log('üì¶ Respuesta:', data);

            if (data.success) {
                showMessage('‚úÖ ¬°Cita agendada exitosamente!', 'success');
                
                // Mostrar informaci√≥n adicional
                setTimeout(() => {
                    alert(`¬°Cita agendada exitosamente!

üìÖ Fecha: ${formatDate(selectedDate)}
üïê Hora: ${selectedTime}
üë®‚Äç‚öïÔ∏è Veterinario: Dr. ${veterinarians.find(v => v.id === selectedVet)?.first_name} ${veterinarians.find(v => v.id === selectedVet)?.last_name}
üêæ Mascota: ${userPets.find(p => p.id === selectedPet)?.name}

Recibir√°s una confirmaci√≥n por email. Recuerda confirmar tu asistencia 24 horas antes de la cita.`);

                    // Redirigir al dashboard
                    window.location.href = DASHBOARD_URL;
                }, 1000);
            } else {
                throw new Error(data.message || 'Error al agendar la cita');
            }

        } catch (error) {
            console.error('‚ùå Error al confirmar cita:', error);
            showMessage(`Error al agendar la cita: ${error.message}`, 'error');
            
            // Rehabilitar bot√≥n
            const confirmBtn = document.getElementById('confirmBooking');
            confirmBtn.disabled = false;
            confirmBtn.innerHTML = 'üóìÔ∏è Confirmar Cita';
        }
    }

    // =============== FUNCIONES AUXILIARES ===============
    function formatPetAge(years, months) {
        years = parseInt(years) || 0;
        months = parseInt(months) || 0;

        if (years === 0 && months === 0) {
            return 'Cachorro';
        } else if (years === 0) {
            return `${months} ${months === 1 ? 'mes' : 'meses'}`;
        } else if (months === 0) {
            return `${years} ${years === 1 ? 'a√±o' : 'a√±os'}`;
        } else {
            return `${years} ${years === 1 ? 'a√±o' : 'a√±os'} y ${months} ${months === 1 ? 'mes' : 'meses'}`;
        }
    }

    function getPetIcon(species) {
        const icons = {
            'perro': 'üêï',
            'gato': 'üê±',
            'ave': 'üê¶',
            'conejo': 'üê∞',
            'reptil': 'ü¶é',
            'pez': 'üê†'
        };
        return icons[species?.toLowerCase()] || 'üêæ';
    }

    function capitalizePetSpecies(species) {
        const translations = {
            'perro': 'Perro',
            'gato': 'Gato',
            'ave': 'Ave',
            'conejo': 'Conejo',
            'reptil': 'Reptil',
            'pez': 'Pez'
        };
        return translations[species?.toLowerCase()] || species;
    }

    function getVaccinationStatus(status) {
        const statuses = {
            'completo': '‚úÖ Completa',
            'parcial': 'üü° Parcial',
            'pendiente': '‚ùå Pendiente'
        };
        return statuses[status] || status;
    }

    function getScheduleText(schedule) {
        if (!schedule || Object.keys(schedule).length === 0) {
            return 'Horarios por confirmar';
        }

        const dayNames = {
            'monday': 'Lun',
            'tuesday': 'Mar',
            'wednesday': 'Mi√©',
            'thursday': 'Jue',
            'friday': 'Vie',
            'saturday': 'S√°b',
            'sunday': 'Dom'
        };

        const activeDays = Object.keys(schedule).filter(day =>
            schedule[day] && schedule[day].active
        );

        if (activeDays.length === 0) {
            return 'Sin disponibilidad';
        }

        return `Disponible: ${activeDays.map(day => dayNames[day]).join(', ')}`;
    }

    function isDateAvailable(date) {
        if (!selectedVet) return false;

        const vet = veterinarians.find(v => v.id === selectedVet);
        if (!vet || !vet.schedule) {
            return true; // Si no hay horario definido, permitir selecci√≥n
        }

        const dayOfWeek = getDayOfWeek(date.toISOString().split('T')[0]);
        const daySchedule = vet.schedule[dayOfWeek];

        return daySchedule && daySchedule.active;
    }

    function getDayOfWeek(dateString) {
        const date = new Date(dateString);
        const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
        return days[date.getDay()];
    }

    function timeToMinutes(timeString) {
        const [hours, minutes] = timeString.split(':').map(Number);
        return hours * 60 + minutes;
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('es-ES', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }

    function showEmptyState(containerId, icon, title, message, buttonText = null, buttonAction = null) {
        const container = document.getElementById(containerId);
        let buttonHTML = '';

        if (buttonText && buttonAction) {
            if (buttonAction.startsWith('http') || buttonAction.startsWith('/')) {
                buttonHTML = `<a href="${buttonAction}" class="btn btn-primary">${buttonText}</a>`;
            } else {
                buttonHTML = `<button class="btn btn-primary" onclick="${buttonAction}">${buttonText}</button>`;
            }
        }

        container.innerHTML = `
            <div class="empty-state">
                <div style="font-size: 3.5rem; margin-bottom: 20px;">${icon}</div>
                <h3>${title}</h3>
                <p>${message}</p>
                ${buttonHTML}
            </div>
        `;
    }

    function showMessage(message, type = 'info') {
        // Crear elemento de mensaje
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type}`;
        alertDiv.textContent = message;
        alertDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            animation: slideInRight 0.3s ease;
        `;

        // Colores seg√∫n el tipo
        switch(type) {
            case 'success':
                alertDiv.style.background = '#B7E4C7';
                alertDiv.style.color = '#2D6A4F';
                alertDiv.style.borderLeft = '4px solid #52B788';
                break;
            case 'error':
                alertDiv.style.background = '#ffebee';
                alertDiv.style.color = '#c62828';
                alertDiv.style.borderLeft = '4px solid #c62828';
                break;
            case 'warning':
                alertDiv.style.background = '#fff3e0';
                alertDiv.style.color = '#f57c00';
                alertDiv.style.borderLeft = '4px solid #ff9800';
                break;
            default:
                alertDiv.style.background = '#e3f2fd';
                alertDiv.style.color = '#1976d2';
                alertDiv.style.borderLeft = '4px solid #2196f3';
        }

        document.body.appendChild(alertDiv);

        // Auto-remover despu√©s de 5 segundos
        setTimeout(() => {
            alertDiv.style.animation = 'slideInRight 0.3s ease reverse';
            setTimeout(() => alertDiv.remove(), 300);
        }, 5000);
    }

    // =============== HACER FUNCIONES GLOBALES ===============
    window.selectPet = selectPet;
    window.selectVet = selectVet;
    window.selectDate = selectDate;
    window.selectTime = selectTime;
    window.showMessage = showMessage;

    console.log('‚úÖ Sistema de agendamiento inicializado correctamente');
})();
</script>
{% endblock %}